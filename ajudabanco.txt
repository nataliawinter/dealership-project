

///criar tabelas
CREATE TABLE AGENCIA (
       COD_AGENCIA NUMBER(5)    NOT NULL,
       NOME        VARCHAR2(50) NOT NULL, 
       ENDERECO    VARCHAR2(50) NULL,
       DDD_FONE    NUMBER(10)   NULL,
  CONSTRAINT PK_AGENCIA PRIMARY KEY(COD_AGENCIA)
)
/
CREATE TABLE CONTA (
       NRO_CONTA            NUMBER(14)   NOT NULL,
       COD_AGENCIA          NUMBER(5)    NOT NULL,
       NOME                 VARCHAR2(50) NOT NULL,
       SALDO                NUMBER(15,2) NOT NULL, 
       LIMITE               NUMBER(10, 2) NULL,
       ENDERECO             VARCHAR2(50) NULL,
       DDD_FONE             NUMBER(10)   NULL,
  CONSTRAINT PK_CONTA PRIMARY KEY(NRO_CONTA)
)
/
ALTER TABLE CONTA
       ADD CONSTRAINT FK_CONTA_AGENCIA 
       FOREIGN KEY (COD_AGENCIA) REFERENCES AGENCIA(cod_agencia)
/
CREATE TABLE OPERACAO (
       NRO_CONTA            NUMBER(14)   NOT NULL,
       DATA                 DATE         NOT NULL,
       DESCRICAO            VARCHAR2(30) NOT NULL,
       TIPO                 VARCHAR2(1)  NOT NULL CONSTRAINT CK_OPERACAO_TIPO CHECK (TIPO IN ('D', 'C')),
       VALOR                NUMBER(15,2) NOT NULL
)
/
ALTER TABLE OPERACAO
       ADD CONSTRAINT PK_OPERACAO PRIMARY KEY (NRO_CONTA, DATA)
/
ALTER TABLE OPERACAO 
       ADD CONSTRAINT FK_OPERACAO_CONTA 
       FOREIGN KEY (NRO_CONTA) REFERENCES CONTA
/
CREATE TABLE APLICACAO (
       COD_APLICACAO        NUMBER(2)   NOT NULL,
       DESCRICAO            VARCHAR2(30) NOT NULL,
  CONSTRAINT PK_APLICACAO PRIMARY KEY(COD_APLICACAO)
)
/
CREATE TABLE APLIC_CONTA (
       NRO_CONTA            NUMBER(14)   NOT NULL,
       DATA                 DATE         NOT NULL,
       COD_APLICACAO        NUMBER(2)    NOT NULL,
       NRO_COTAS            NUMBER(19,6) NOT NULL, 
  CONSTRAINT PK_APLIC_CONTA PRIMARY KEY(NRO_CONTA, DATA, COD_APLICACAO)
)
/
ALTER TABLE APLIC_CONTA 
       ADD CONSTRAINT FK_APLIC_CONTA_CONTA 
       FOREIGN KEY (NRO_CONTA) REFERENCES CONTA
/
ALTER TABLE APLIC_CONTA
       ADD CONSTRAINT FK_APLIC_CONTA_APLICACAO 
       FOREIGN KEY (COD_APLICACAO) REFERENCES APLICACAO
/
CREATE TABLE APLIC_COTA (
       COD_APLICACAO        NUMBER(2)    NOT NULL,
       DATA                 DATE         NOT NULL,
       VALOR_COTA           NUMBER(19,6) NOT NULL, 
  CONSTRAINT PK_APLIC_COTA PRIMARY KEY(COD_APLICACAO, DATA)
)
/
ALTER TABLE APLIC_COTA
       ADD CONSTRAINT FK_APLIC_COTA_APLICACAO 
       FOREIGN KEY (COD_APLICACAO) REFERENCES APLICACAO
/
CREATE TABLE TIPO_CARTAO (
       COD_TIPO_CARTAO      NUMBER(2)    NOT NULL,
       DESCRICAO            VARCHAR2(30) NOT NULL,
  CONSTRAINT PK_TIPO_CARTAO PRIMARY KEY(COD_TIPO_CARTAO)
)
/
CREATE TABLE CARTAO (
       NRO_CARTAO           NUMBER(16)   NOT NULL,
       NRO_CONTA            NUMBER(14)   NOT NULL,
       COD_TIPO_CARTAO      NUMBER(2)    NOT NULL,
       LIMITE               NUMBER(15,2) NOT NULL,
       DIA_VECTO            NUMBER(2)    NOT NULL,
  CONSTRAINT PK_CARTAO PRIMARY KEY(NRO_CARTAO)
)
/
ALTER TABLE CARTAO
       ADD CONSTRAINT FK_CARTAO_CONTA 
       FOREIGN KEY (NRO_CONTA) REFERENCES CONTA
/
ALTER TABLE CARTAO
       ADD CONSTRAINT FK_CARTAO_TIPO_CARTAO 
       FOREIGN KEY (COD_TIPO_CARTAO) REFERENCES TIPO_CARTAO
/
CREATE TABLE ESTABELECIMENTO (
       COD_ESTABELECIMENTO  NUMBER(5)   NOT NULL,
       NOME                 VARCHAR2(50) NOT NULL,
  CONSTRAINT PK_ESTABELECIMENTO PRIMARY KEY(COD_ESTABELECIMENTO)
)
/
CREATE TABLE FATURA (
       COD_FATURA           NUMBER(15)   NOT NULL,
       NRO_CARTAO           NUMBER(16)   NOT NULL,
       DATA_VECTO           DATE         NOT NULL,
       VALOR                NUMBER(15,2) NOT NULL,
       DATA_PAGTO           DATE         NULL,
       VALOR_PAGTO          NUMBER(15,2) NULL,
  CONSTRAINT PK_FATURA PRIMARY KEY(COD_FATURA)
)
/
ALTER TABLE FATURA
       ADD CONSTRAINT FK_FATURA_CARTAO
       FOREIGN KEY (NRO_CARTAO) REFERENCES CARTAO
/
CREATE TABLE MOVTO_CARTAO (
       NRO_CARTAO           NUMBER(16)   NOT NULL,
       DATA                 DATE         NOT NULL,
       COD_ESTABELECIMENTO  NUMBER(5)    NOT NULL,
       VALOR                NUMBER(15,2) NOT NULL,
       COD_FATURA           NUMBER(15)   NULL,
  CONSTRAINT PK_MOVTO_CARTAO PRIMARY KEY(NRO_CARTAO, DATA)
)
/
ALTER TABLE MOVTO_CARTAO
       ADD CONSTRAINT FK_MOVTO_CARTAO_CARTAO
       FOREIGN KEY (NRO_CARTAO) REFERENCES CARTAO
/
ALTER TABLE MOVTO_CARTAO
       ADD CONSTRAINT FK_MOVTO_CARTAO_ESTAB
       FOREIGN KEY (COD_ESTABELECIMENTO) REFERENCES ESTABELECIMENTO
/
ALTER TABLE MOVTO_CARTAO
       ADD CONSTRAINT FK_MOVTO_CARTAO_FATURA
       FOREIGN KEY (COD_FATURA) REFERENCES FATURA
/
